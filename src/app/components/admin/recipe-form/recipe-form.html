<form (ngSubmit)="handleSubmit()" class="space-y-6">
  <div class="grid grid-cols-1 gap-4">
    <!-- Title -->
    <div class="space-y-2">
      <label for="title" class="block text-sm font-medium text-gray-700"
        >Título</label
      >
      <input
        id="title"
        pInputText
        [(ngModel)]="formData.title"
        name="title"
        required
        class="w-full"
        placeholder="Nombre de la receta"
      />
    </div>

    <!-- Description -->
    <div class="space-y-2">
      <label for="description" class="block text-sm font-medium text-gray-700"
        >Descripción</label
      >
      <textarea
        id="description"
        [(ngModel)]="formData.description"
        name="description"
        required
        class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
        rows="3"
        placeholder="Describe la receta..."
      ></textarea>
    </div>

    <!-- Difficulty, Preparation Time, Category -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
      <div class="space-y-2">
        <label for="difficulty" class="block text-sm font-medium text-gray-700"
          >Dificultad</label
        >
        <select
          id="difficulty"
          [(ngModel)]="formData.difficulty"
          name="difficulty"
          class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
        >
          <option value="">Seleccionar</option>
          <option
            *ngFor="let option of difficultyOptions"
            [value]="option.value"
          >
            {{ option.label }}
          </option>
        </select>
      </div>

      <div class="space-y-2">
        <label
          for="preparationTime"
          class="block text-sm font-medium text-gray-700"
          >Tiempo de Preparación</label
        >
        <input
          id="preparationTime"
          pInputText
          [(ngModel)]="formData.preparationTime"
          name="preparationTime"
          required
          class="w-full"
          placeholder="ej: 30 min"
        />
      </div>

      <div class="space-y-2">
        <label for="category" class="block text-sm font-medium text-gray-700"
          >Categoría</label
        >
        <select
          id="category"
          [(ngModel)]="formData.category"
          name="category"
          class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
          required
        >
          <option value="">Seleccionar categoría</option>
          <option *ngFor="let category of categories" [ngValue]="category">
            {{ category.name }}
          </option>
        </select>
      </div>
    </div>
  </div>

  <!-- Ingredients Card -->
  <p-card>
    <ng-template pTemplate="header">
      <div class="flex items-center justify-between">
        <h3 class="text-lg font-semibold">Ingredientes</h3>
        <p-button
          type="button"
          severity="secondary"
          size="small"
          (onClick)="addIngredient()"
          icon="pi pi-plus"
          label="Agregar"
        ></p-button>
      </div>
    </ng-template>
    <ng-template pTemplate="content">
      <div class="space-y-4">
        <div
          *ngFor="
            let ingredient of formData.ingredients;
            let i = index;
            trackBy: trackByIngredientIndex
          "
          class="flex gap-2 items-end"
        >
          <div class="flex-1">
            <label class="block text-sm font-medium text-gray-700 mb-1"
              >Ingrediente</label
            >
            <input
              pInputText
              [ngModel]="ingredient.name"
              (ngModelChange)="updateIngredient(i, 'name', $event)"
              [name]="'ingredient_name_' + i"
              placeholder="Nombre del ingrediente"
              class="w-full"
            />
          </div>
          <div class="w-28">
            <label class="block text-sm font-medium text-gray-700 mb-1"
              >Cantidad</label
            >
            <p-inputNumber
              [ngModel]="ingredient.quantity"
              (ngModelChange)="updateIngredient(i, 'quantity', $event)"
              [name]="'ingredient_quantity_' + i"
              placeholder="0"
              [minFractionDigits]="0"
              [maxFractionDigits]="2"
              class="w-full"
            ></p-inputNumber>
          </div>
          <div class="w-24">
            <label class="block text-sm font-medium text-gray-700 mb-1"
              >Unidad</label
            >
            <input
              pInputText
              [ngModel]="ingredient.unit"
              (ngModelChange)="updateIngredient(i, 'unit', $event)"
              [name]="'ingredient_unit_' + i"
              placeholder="gr, ml, etc"
              class="w-full"
            />
          </div>
          <p-button
            type="button"
            severity="secondary"
            size="small"
            (onClick)="removeIngredient(i)"
            icon="pi pi-trash"
            [disabled]="formData.ingredients.length === 1"
          ></p-button>
        </div>
      </div>
    </ng-template>
  </p-card>

  <!-- Instructions Card -->
  <p-card>
    <ng-template pTemplate="header">
      <div class="flex items-center justify-between">
        <h3 class="text-lg font-semibold">Instrucciones</h3>
        <p-button
          type="button"
          severity="secondary"
          size="small"
          (onClick)="addInstruction()"
          icon="pi pi-plus"
          label="Agregar"
        ></p-button>
      </div>
    </ng-template>
    <ng-template pTemplate="content">
      <div class="space-y-4">
        <div
          *ngFor="
            let instruction of formData.instructions;
            let i = index;
            trackBy: trackByInstructionIndex
          "
          class="flex gap-2 items-start"
        >
          <div class="w-12 pt-2">
            <span class="text-sm font-medium">#{{ instruction.step }}</span>
          </div>
          <div class="flex-1">
            <textarea
              [ngModel]="instruction.description"
              (ngModelChange)="updateInstruction(i, $event)"
              [name]="'instruction_description_' + i"
              placeholder="Describe el paso..."
              rows="2"
              class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
            ></textarea>
          </div>
          <p-button
            type="button"
            severity="secondary"
            size="small"
            (onClick)="removeInstruction(i)"
            icon="pi pi-trash"
            [disabled]="formData.instructions.length === 1"
          ></p-button>
        </div>
      </div>
    </ng-template>
  </p-card>

  <!-- Images Card -->
  <p-card>
    <ng-template pTemplate="header">
      <div class="flex items-center justify-between">
        <h3 class="text-lg font-semibold">Imágenes</h3>
        <p-button
          type="button"
          severity="secondary"
          size="small"
          (onClick)="addImage()"
          icon="pi pi-plus"
          label="Agregar"
        ></p-button>
      </div>
    </ng-template>
    <ng-template pTemplate="content">
      <div class="space-y-4">
        <div
          *ngFor="
            let image of formData.images;
            let i = index;
            trackBy: trackByImageIndex
          "
          class="flex gap-2 items-center"
        >
          <div class="flex-1">
            <input
              pInputText
              [ngModel]="image.url"
              (ngModelChange)="updateImage(i, $event)"
              [name]="'image_url_' + i"
              placeholder="URL de la imagen"
              class="w-full"
            />
          </div>
          <p-button
            type="button"
            severity="secondary"
            size="small"
            (onClick)="removeImage(i)"
            icon="pi pi-trash"
            [disabled]="formData.images.length === 1"
          ></p-button>
        </div>
      </div>
    </ng-template>
  </p-card>

  <!-- Submit Button -->
  <div class="flex justify-end gap-2">
    <p-button
      type="submit"
      [label]="isEditing ? 'Actualizar Receta' : 'Crear Receta'"
      icon="pi pi-check"
    ></p-button>
  </div>
</form>

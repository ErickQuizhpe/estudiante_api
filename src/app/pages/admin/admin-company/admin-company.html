<div class="admin-company-container">
  <p-toast></p-toast>
  <p-confirmDialog></p-confirmDialog>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading-container">
    <p-card>
      <p>Cargando información de la empresa...</p>
    </p-card>
  </div>

  <!-- Company Information -->
  <div *ngIf="!loading && company" class="company-content">
    
    <!-- General Information Section -->
    <p-card header="Información General de la Empresa" class="info-card">
      <div class="card-actions">
        <p-button 
          *ngIf="!editMode"
          label="Editar" 
          icon="pi pi-pencil" 
          (click)="enableEdit()"
          severity="info">
        </p-button>
        <div *ngIf="editMode" class="edit-buttons">
          <p-button 
            label="Cancelar" 
            icon="pi pi-times" 
            (click)="cancelEdit()"
            severity="secondary"
            [outlined]="true">
          </p-button>
          <p-button 
            label="Guardar" 
            icon="pi pi-check" 
            (click)="saveCompany()"
            severity="success">
          </p-button>
        </div>
      </div>

      <form [formGroup]="companyForm" class="company-form">
        <div class="form-grid">
          <div class="form-row">
            <div class="form-field">
              <label for="name">Nombre de la Empresa *</label>
              <input 
                pInputText 
                id="name" 
                formControlName="name" 
                [disabled]="!editMode"
                placeholder="Nombre de la empresa">
            </div>
            <div class="form-field">
              <label for="logoUrl">URL del Logo</label>
              <input 
                pInputText 
                id="logoUrl" 
                formControlName="logoUrl" 
                [disabled]="!editMode"
                placeholder="https://ejemplo.com/logo.png">
            </div>
          </div>

          <div class="form-field full-width">
            <label for="description">Descripción</label>
            <textarea 
              formControlName="description" 
              [disabled]="!editMode"
              rows="3" 
              class="form-textarea"
              placeholder="Descripción de la empresa">
            </textarea>
          </div>

          <div class="form-row">
            <div class="form-field">
              <label for="phone">Teléfono</label>
              <input 
                pInputText 
                id="phone" 
                formControlName="phone" 
                [disabled]="!editMode"
                placeholder="+1 234 567 8900">
            </div>
            <div class="form-field">
              <label for="email">Email *</label>
              <input 
                pInputText 
                id="email" 
                formControlName="email" 
                [disabled]="!editMode"
                placeholder="contacto@empresa.com">
            </div>
          </div>

          <div class="form-row">
            <div class="form-field">
              <label for="address">Dirección</label>
              <input 
                pInputText 
                id="address" 
                formControlName="address" 
                [disabled]="!editMode"
                placeholder="Dirección completa">
            </div>
            <div class="form-field">
              <label for="city">Ciudad</label>
              <input 
                pInputText 
                id="city" 
                formControlName="city" 
                [disabled]="!editMode"
                placeholder="Ciudad">
            </div>
          </div>

          <div class="form-field full-width">
            <label for="footerText">Texto del Footer</label>
            <textarea 
              formControlName="footerText" 
              [disabled]="!editMode"
              rows="2" 
              class="form-textarea"
              placeholder="Texto que aparecerá en el pie de página">
            </textarea>
          </div>

          <div class="form-row">
            <div class="form-field">
              <label for="mission">Misión</label>
              <textarea 
                formControlName="mission" 
                [disabled]="!editMode"
                rows="3" 
                class="form-textarea"
                placeholder="Misión de la empresa">
              </textarea>
            </div>
            <div class="form-field">
              <label for="vision">Visión</label>
              <textarea 
                formControlName="vision" 
                [disabled]="!editMode"
                rows="3" 
                class="form-textarea"
                placeholder="Visión de la empresa">
              </textarea>
            </div>
          </div>
        </div>
      </form>
    </p-card>

    <!-- Social Media Section -->
    <p-card header="Redes Sociales" class="social-media-card">
      <div class="section-header">
        <p>Gestiona las redes sociales de la empresa</p>
        <p-button 
          label="Agregar Red Social" 
          icon="pi pi-plus" 
          (click)="openSocialMediaDialog()"
          severity="success">
        </p-button>
      </div>

      <div *ngIf="company.socialMedia && company.socialMedia.length > 0; else noSocialMedia">
        <p-table [value]="company.socialMedia" styleClass="p-datatable-gridlines">
          <ng-template pTemplate="header">
            <tr>
              <th>Plataforma</th>
              <th>URL</th>
              <th>Estado</th>
              <th>Acciones</th>
            </tr>
          </ng-template>
          <ng-template pTemplate="body" let-social>
            <tr>
              <td>
                <div class="platform-info">
                  <img *ngIf="social.iconUrl" [src]="social.iconUrl" alt="{{social.platform}}" class="platform-icon">
                  <span>{{ social.platform }}</span>
                </div>
              </td>
              <td>
                <a [href]="social.url" target="_blank" class="social-link">{{ social.url }}</a>
              </td>
              <td>
                <p-tag 
                  [value]="social.active ? 'Activo' : 'Inactivo'" 
                  [severity]="social.active ? 'success' : 'danger'">
                </p-tag>
              </td>
              <td>
                <div class="action-buttons">
                  <p-button 
                    icon="pi pi-pencil" 
                    (click)="openSocialMediaDialog(social)"
                    severity="info"
                    [text]="true"
                    pTooltip="Editar">
                  </p-button>
                  <p-button 
                    icon="pi pi-trash" 
                    (click)="deleteSocialMedia(social)"
                    severity="danger"
                    [text]="true"
                    pTooltip="Eliminar">
                  </p-button>
                </div>
              </td>
            </tr>
          </ng-template>
        </p-table>
      </div>

      <ng-template #noSocialMedia>
        <div class="empty-state">
          <i class="pi pi-share-alt empty-icon"></i>
          <p>No hay redes sociales configuradas</p>
          <p-button 
            label="Agregar Primera Red Social" 
            icon="pi pi-plus" 
            (click)="openSocialMediaDialog()">
          </p-button>
        </div>
      </ng-template>
    </p-card>

    <!-- Banners Section -->
    <p-card header="Banners" class="banners-card">
      <div class="section-header">
        <p>Gestiona los banners de la empresa</p>
        <p-button 
          label="Agregar Banner" 
          icon="pi pi-plus" 
          (click)="openBannerDialog()"
          severity="success">
        </p-button>
      </div>

      <div *ngIf="company.banners && company.banners.length > 0; else noBanners">
        <div class="banners-grid">
          <div *ngFor="let banner of company.banners" class="banner-item">
            <div class="banner-preview">
              <img [src]="banner.imageUrl" [alt]="banner.description" class="banner-image">
              <div class="banner-overlay">
                <p-button 
                  icon="pi pi-pencil" 
                  (click)="openBannerDialog(banner)"
                  severity="info"
                  [rounded]="true">
                </p-button>
                <p-button 
                  icon="pi pi-trash" 
                  (click)="deleteBanner(banner)"
                  severity="danger"
                  [rounded]="true">
                </p-button>
              </div>
            </div>
            <div class="banner-info">
              <p class="banner-description">{{ banner.description || 'Sin descripción' }}</p>
              <p-tag 
                [value]="banner.active ? 'Activo' : 'Inactivo'" 
                [severity]="banner.active ? 'success' : 'danger'">
              </p-tag>
            </div>
          </div>
        </div>
      </div>

      <ng-template #noBanners>
        <div class="empty-state">
          <i class="pi pi-image empty-icon"></i>
          <p>No hay banners configurados</p>
          <p-button 
            label="Agregar Primer Banner" 
            icon="pi pi-plus" 
            (click)="openBannerDialog()">
          </p-button>
        </div>
      </ng-template>
    </p-card>
  </div>

  <!-- Social Media Dialog -->
  <p-dialog 
    [(visible)]="socialMediaDialog" 
    [header]="editingSocialMedia ? 'Editar Red Social' : 'Nueva Red Social'"
    [modal]="true" 
    class="p-fluid" 
    [style]="{width:'40vw'}"
    [maximizable]="true">
    
    <div class="form-grid">
      <div class="form-field">
        <label for="platform">Plataforma *</label>
        <input 
          pInputText 
          id="platform" 
          [(ngModel)]="socialMediaForm.platform" 
          placeholder="Facebook, Instagram, Twitter, etc.">
      </div>

      <div class="form-field">
        <label for="url">URL *</label>
        <input 
          pInputText 
          id="url" 
          [(ngModel)]="socialMediaForm.url" 
          placeholder="https://facebook.com/empresa">
      </div>

      <div class="form-field">
        <label for="iconUrl">URL del Icono</label>
        <input 
          pInputText 
          id="iconUrl" 
          [(ngModel)]="socialMediaForm.iconUrl" 
          placeholder="https://ejemplo.com/icono.png">
      </div>

      <div class="form-field">
        <label class="checkbox-label">
          <input 
            type="checkbox" 
            [(ngModel)]="socialMediaForm.active"
            class="form-checkbox">
          <span>Activo</span>
        </label>
      </div>
    </div>

    <ng-template pTemplate="footer">
      <p-button 
        label="Cancelar" 
        icon="pi pi-times" 
        (click)="socialMediaDialog = false"
        [text]="true">
      </p-button>
      <p-button 
        label="Guardar" 
        icon="pi pi-check" 
        (click)="saveSocialMedia()">
      </p-button>
    </ng-template>
  </p-dialog>

  <!-- Banner Dialog -->
  <p-dialog 
    [(visible)]="bannerDialog" 
    [header]="editingBanner ? 'Editar Banner' : 'Nuevo Banner'"
    [modal]="true" 
    class="p-fluid" 
    [style]="{width:'50vw'}"
    [maximizable]="true">
    
    <div class="form-grid">
      <div class="form-field">
        <label for="imageUrl">URL de la Imagen *</label>
        <input 
          pInputText 
          id="imageUrl" 
          [(ngModel)]="bannerForm.imageUrl" 
          placeholder="https://ejemplo.com/banner.jpg">
      </div>

      <div class="form-field">
        <label for="description">Descripción</label>
        <textarea 
          [(ngModel)]="bannerForm.description" 
          rows="3" 
          class="form-textarea"
          placeholder="Descripción del banner">
        </textarea>
      </div>

      <div class="form-field">
        <label class="checkbox-label">
          <input 
            type="checkbox" 
            [(ngModel)]="bannerForm.active"
            class="form-checkbox">
          <span>Activo</span>
        </label>
      </div>

      <!-- Preview -->
      <div *ngIf="bannerForm.imageUrl" class="banner-preview-container">
        <label>Vista Previa:</label>
        <img [src]="bannerForm.imageUrl" alt="Preview" class="banner-preview-image">
      </div>
    </div>

    <ng-template pTemplate="footer">
      <p-button 
        label="Cancelar" 
        icon="pi pi-times" 
        (click)="bannerDialog = false"
        [text]="true">
      </p-button>
      <p-button 
        label="Guardar" 
        icon="pi pi-check" 
        (click)="saveBanner()">
      </p-button>
    </ng-template>
  </p-dialog>
</div>
